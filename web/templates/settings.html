{% extends "base.html" %}

{% block title %}Ρυθμίσεις · Meeting Collector{% endblock %}

{% block head_extra %}
<link rel="stylesheet" href="{{ url_for('static', path='app.css') }}">

{% if (active if active is defined and active else 'email-accounts') == 'email-accounts' %}
<link rel="stylesheet" href="{{ url_for('static', path='email-accounts.css') }}">
{% elif (active if active is defined and active else 'email-accounts') == 'notifications' %}
<link rel="stylesheet" href="{{ url_for('static', path='notifications.css') }}">
{% elif (active if active is defined and active else 'email-accounts') == 'profile' %}
<link rel="stylesheet" href="{{ url_for('static', path='profile.css') }}">
{% elif (active if active is defined and active else 'email-accounts') == 'security' %}
<link rel="stylesheet" href="{{ url_for('static', path='security.css') }}">
{% endif %}
{% endblock %}


{% block content %}
{% set section = (active if active is defined and active else 'email-accounts') %}
<body>
<header class="topbar">
    <div class="brand" onclick="location.href='/'">Meeting Collector</div>
    <nav class="nav-right">
        {% if user %}
        <!--<a href="/settings" class="link">Ρυθμίσεις</a>-->
        <a href="{{ request.url_for('settings_page') }}" class="link">Ρυθμίσεις</a>
        <span class="sep">|</span>
        <a href="{{ request.url_for('logout') }}" class="btn btn-ghost">Αποσύνδεση</a>
        {% else %}
        <a href="/login" class="btn">Σύνδεση</a>
        {% endif %}
    </nav>
</header>

<!--Add in-->
<div class="settings-layout">

    <aside class="settings-sidebar">
        <!--        <div class="settings-sidebar-title">Ρυθμίσεις</div>-->
        <nav>
            <!--            <a class="settings-link {{ 'active' if active == 'email-accounts' else '' }}"-->
            <!--               href="{{ request.url_for('settings_page') }}">Email Accounts</a>-->
            <!--            &lt;!&ndash; placeholders για επόμενα tabs &ndash;&gt;-->
            <!--            <a class="settings-link {{ 'active' if active == 'profile' else '' }}"-->
            <!--               href="{{ request.url_for('settings_page') }}profile">Profile</a>-->
            <!--            <a class="settings-link {{ 'active' if active == 'security' else '' }}"-->
            <!--               href="{{ request.url_for('settings_page') }}security">Security</a>-->
            <!--            <a class="settings-link {{ 'active' if active == 'notifications' else '' }}"-->
            <!--               href="{{ request.url_for('settings_page') }}notifications">Notifications</a>-->
            <a class="settings-link {{ 'active' if section == 'profile' else '' }}"
               href="{{ request.url_for('settings_page', section='profile') }}">Profile</a>
            <a class="settings-link {{ 'active' if section == 'email-accounts' else '' }}"
               href="{{ request.url_for('settings_page') }}">Email Accounts</a>
            <a class="settings-link {{ 'active' if section == 'notifications' else '' }}"
               href="{{ request.url_for('settings_page', section='notifications') }}">Notifications</a>
            <a class="settings-link {{ 'active' if section == 'security' else '' }}"
               href="{{ request.url_for('settings_page', section='security') }}">Security</a>
        </nav>
    </aside>


    <main class="settings-content">
        <!--<header class="settings-header">
            <h1 class="settings-breadcrumb">{{ 'Email Accounts' if active == 'email-accounts' else active|capitalize
                }}</h1>
            &lt;!&ndash;            <div class="settings-breadcrumb">{{ 'Email Accounts' if active == 'email-accounts' else active|capitalize }}&ndash;&gt;
            &lt;!&ndash;                <div class="settings-breadcrumb">{{ section|capitalize }}&ndash;&gt;
            &lt;!&ndash;            </div>&ndash;&gt;
        </header>-->

        <!-- Banner area (JS θα εγχέει εδώ flash μηνύματα) -->
        <div id="banner-area"></div>


        {% if section == 'profile' %}

        <section class="card">
            <h2>Profile</h2>

            <form id="formProfile" class="grid-form">

                <!-- Διατήρηση δεδομένων -->
                <div class="full-row"><h3>Διατήρηση δεδομένων</h3></div>

                <label>
                    Μήνες διατήρησης meetings
                    <input type="number"
                           id="prof_retention_months"
                           name="prof_retention_months"
                           min="1" max="3" step="1"
                           placeholder="3">
                </label>

                <!-- Φάκελοι για parsing -->
                <div class="full-row"><h3>Φάκελοι για parsing</h3></div>
                <p class="muted full-row">
                    Επέλεξε ποιους φακέλους θα σαρώνει ο parser. Αν επιλέξεις μόνο έναν, θα γίνεται parsing αποκλειστικά σε αυτόν.
                </p>

                <!-- Δυναμικό container που θα γεμίζει από JS με τους λογαριασμούς & φακέλους -->
                <div id="prof-folders" class="accounts-folders full-row">
                    <!-- JS θα προσθέσει blocks ανά λογαριασμό:
                         <div class="account-block" data-account-id="12">
                           <div class="acc-header">
                             <div class="acc-title">it gmail — it.helioaiolis@gmail.com</div>
                             <button type="button" class="btn btn-ghost btn-sm" data-refresh-folders>Ανανέωση φακέλων</button>
                           </div>
                           <div class="folders-grid">
                             <label class="folder-check">
                               <input type="checkbox" name="prof_folders[12]" value="INBOX">
                               <span class="label-text">Inbox</span>
                             </label>
                             ...
                           </div>
                         </div>
                    -->
                    <div class="placeholder">
                        Δεν έχουν φορτωθεί ακόμη οι φάκελοι. Πάτησε «Φόρτωση φακέλων».
                    </div>
                </div>

                <div class="full-row actions">
                    <button type="button" class="btn" id="btnLoadFolders">Φόρτωση φακέλων</button>
                    <button type="submit" class="btn btn-primary" id="btnSaveProfile">Αποθήκευση</button>
                </div>
            </form>
        </section>

        {% elif section == 'email-accounts' %}
        <section class="card">
            <h2>Προσθήκη Λογαριασμού Email</h2>
            <form id="formAddAccount" class="grid-form">
                <div class="full-row">
                    <h3>IMAP Credentials</h3>
                </div>

                <label>
                    Display Name
                    <input name="display_name" required>
                </label>

                <label>
                    Email
                    <input name="email" type="email" required>
                </label>

                <label>
                    Password
                    <input name="imap_password" type="password" required>
                </label>

                <label>
                    IMAP Host
                    <input name="imap_host" required>
                </label>


                <div class="grid-span-4" style="align-self:end">
                    <button type="button" class="btn btn-secondary " onclick="testImap()">Test Connection</button>
                    <button class="btn btn-primary">Προσθήκη</button>
                </div>


                <!--                <label>Port<br><input name="imap_port" type="number" value="993"></label>-->

                <!--                <label>SSL<br>-->
                <!--                    <select name="imap_ssl">-->
                <!--                        <option value="true">Ναι</option>-->
                <!--                        <option value="false">Όχι</option>-->
                <!--                    </select>-->
                <!--                </label>-->
                <!--                <label>User<br><input name="imap_user" ></label>-->


                <!--<div class="grid-span-2"><h3>SMTP</h3></div>
                <label>Host<br><input name="smtp_host" ></label>
                <label>Port<br><input name="smtp_port" type="number" value="587" ></label>
                <label>SSL<br>
                    <select name="smtp_ssl">
                        <option value="false">Όχι</option>
                        <option value="true">Ναι</option>
                    </select>
                </label>
                <label>User<br><input name="smtp_user" ></label>
                <label>Password<br><input name="smtp_password" type="password" ></label>-->


            </form>
        </section>

        <section class="card">
            <h2>Λογαριασμοί</h2>
            <table class="table" id="tblAccounts">
                <thead>
                <tr>
                    <th class="col-status">Status</th>
                    <th class="col-id">ID</th>
                    <th class="col-display">Display Name</th>
                    <th class="col-email">Email</th>
                    <th class="col-imap">IMAP</th>
                    <th class="col-smtp">SMTP</th>
                    <th class="col-actions"></th>
                </tr>
                </thead>
                <tbody id="accountsBody">
                <!-- γεμίζει από JS -->
                </tbody>
            </table>
        </section>

        {% elif section == 'notifications' %}

        <section class="card">
            <h2>Notifications</h2>

            <form id="formNotifications" class="grid-form">

                <!-- Ημερήσια σύνοψη -->
                <div class="full-row"><h3>Ημερήσια σύνοψη</h3></div>

                <label>
                    Ώρα αποστολής
                    <input type="time" name="not_daily_hour" id="not_daily_hour" required value="07:00">
                </label>

                <fieldset class="full-row">
                    <legend class="legend-label">Μέρες αποστολής</legend>

                    <div class="weekday-row">
                        <label class="check"><input type="checkbox" id="not_days_all"> <span>Όλες</span></label>
                    </div>

                    <div class="weekday-grid">
                        <label class="check"><input type="checkbox" name="not_days" value="mon"><span>Δευτέρα</span></label>
                        <label class="check"><input type="checkbox" name="not_days" value="tue"><span>Τρίτη</span></label>
                        <label class="check"><input type="checkbox" name="not_days" value="wed"><span>Τετάρτη</span></label>
                        <label class="check"><input type="checkbox" name="not_days" value="thu"><span>Πέμπτη</span></label>
                        <label class="check"><input type="checkbox" name="not_days" value="fri"><span>Παρασκευή</span></label>
                        <label class="check"><input type="checkbox" name="not_days" value="sat"><span>Σάββατο</span></label>
                        <label class="check"><input type="checkbox" name="not_days" value="sun"><span>Κυριακή</span></label>
                    </div>

                    <p class="hint">Αν δεν υπάρχει meeting για την ημέρα, θα σταλεί ενημέρωση “Δεν έχει οριστεί κανένα
                        meeting για σήμερα προς το παρόν”.</p>
                </fieldset>


                <div class="full-row"><h3>Υπενθυμίσεις</h3></div>

                <label>
                    Χρόνος πριν την έναρξη
                    <select name="not_prior_minutes" id="not_prior_minutes">
                        <option value="off">Καμία</option>
                        <option value="5">5′</option>
                        <option value="10">10′</option>
                        <option value="15">15′</option>
                        <option value="30">30′</option>
                        <option value="60">60′</option>
                    </select>
                </label>


                <div class="full-row"><h3>Επιπλέον υπενθυμίσεις (<span style="color:red"> Not yet implemented</span>)
                </h3></div>

                <label class="switch-row">
                    <span class="switch-title">Νέα meetings</span>
                    <span class="switch-hint">Όταν εντοπίζεται για πρώτη φορά ένα meeting</span>
                    <span class="switch">
                        <input type="checkbox" name="notify_new_meeting" id="notify_new_meeting">
                        <span class="slider" aria-hidden="true"></span>
                    </span>
                </label>

                <label class="switch-row">
                    <span class="switch-title">Αλλαγές σε meetings</span>
                    <span class="switch-hint">Όταν αλλάζει ώρα/θέμα/συμμετέχοντες</span>
                    <span class="switch">
        <input type="checkbox" name="notify_changes" id="notify_changes">
        <span class="slider" aria-hidden="true"></span>
      </span>
                </label>

                <label class="switch-row">
                    <span class="switch-title">Ακυρώσεις</span>
                    <span class="switch-hint">Όταν ακυρώνεται/διαγράφεται κάποιο meeting</span>
                    <span class="switch">
        <input type="checkbox" name="notify_cancellations" id="notify_cancellations">
        <span class="slider" aria-hidden="true"></span>
      </span>
                </label>

                <!-- SMTP λογαριασμός για αποστολές -->
                <div class="full-row"><h3>SMTP λογαριασμός</h3></div>

                <div class="smtp-grid full-row">
                    <label>
                        SMTP User
                        <input type="text" name="not_user_smtp" id="not_user_smtp" placeholder="user@example.com">
                    </label>

                    <label>
                        SMTP Password
                        <input type="password" name="not_pass_smtp" id="not_pass_smtp" placeholder="••••••••">
                    </label>

                    <label>
                        SMTP Host
                        <input type="text" name="not_smtp_host" id="not_smtp_host" placeholder="smtp.example.com">
                    </label>

                    <label>
                        SMTP Port
                        <input type="number" name="not_smtp_port" id="not_smtp_port" inputmode="numeric" min="1" max="65535" placeholder="465">
                    </label>
                </div>


                <div class="full-row"><h3>Παραλήπτης Ειδοποιήσεων</h3></div>
                <label>
                    Email
                    <input type="text" name="not_receiver" id="not_receiver" placeholder="user@example.com">
                </label>

                <div class="full-row actions">
                    <button type="submit" class="btn btn-primary" id="btnSaveNotifications">Αποθήκευση</button>
                    <button type="button" class="btn btn-ghost" id="btnTestNotif">Δοκιμαστική αποστολή</button>
                    <button type="button" class="btn" id="btnSendSummaryNow">Αποστολή τώρα</button>
                    <button type="button" class="btn" id="btnRemindersNow">Έλεγχος υπενθυμίσεων τώρα</button>

                </div>

            </form>
        </section>


        {% elif section == 'security' %}

        <section class="card"><em>Coming soon: {{ section }}</em></section>

        {% else %}
        <section class="card"><em>Coming soon: {{ section }}</em></section>
        {% endif %}
    </main>
</div>
<!-- Add out-->


<!--<main class="container">-->

<!--    <h1>Ρυθμίσεις χρήστη</h1>-->

<!--    <section class="card">-->
<!--        <h2>Λογαριασμοί Email για Parsing</h2>-->
<!--        <form id="acc-form" class="grid-form">-->
<!--            <div>-->
<!--                <label>Εμφανιζόμενο όνομα<br><input name="display_name"/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>Email<br><input name="email" type="email" required/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>IMAP Host<br><input name="imap_host" required/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>IMAP Port<br><input name="imap_port" type="number" value="993"/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>IMAP SSL<br>-->
<!--                    <select name="imap_ssl">-->
<!--                        <option value="true" selected>Ναι</option>-->
<!--                        <option value="false">Όχι</option>-->
<!--                    </select>-->
<!--                </label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>IMAP User (προαιρετικό)<br><input name="imap_user"/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>IMAP Password<br><input name="imap_password" type="password" required/></label>-->
<!--            </div>-->


<!--            <div>-->
<!--                <label>SMTP Host (προαιρετικό)<br><input name="smtp_host"/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>SMTP Port<br><input name="smtp_port" type="number" value="465"/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>SMTP SSL<br>-->
<!--                    <select name="smtp_ssl">-->
<!--                        <option value="true" selected>Ναι</option>-->
<!--                        <option value="false">Όχι</option>-->
<!--                    </select>-->
<!--                </label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>SMTP User (προαιρετικό)<br><input name="smtp_user"/></label>-->
<!--            </div>-->
<!--            <div>-->
<!--                <label>SMTP Password (προαιρετικό)<br><input name="smtp_password" type="password"/></label>-->
<!--            </div>-->


<!--            <div style="align-self:end">-->
<!--                <button class="btn btn-primary" type="submit">Προσθήκη</button>-->
<!--            </div>-->
<!--        </form>-->
<!--        <div id="acc-msg" class="muted" style="margin-top: .5rem"></div>-->


<!--        <table class="table" id="acc-table">-->
<!--            <thead>-->
<!--            <tr>-->
<!--                <th>ID</th>-->
<!--                <th>Όνομα</th>-->
<!--                <th>Email</th>-->
<!--                <th>IMAP</th>-->
<!--                <th>SMTP</th>-->
<!--                <th></th>-->
<!--            </tr>-->
<!--            </thead>-->
<!--            <tbody></tbody>-->
<!--        </table>-->
<!--    </section>-->
<!--</main>-->


</body>
<script defer src="{{ url_for('static', path='settings.js') }}"></script>
{% endblock %}